{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "PlannerOutput",
    "description": "Architectural plan produced by the Planner Agent. This output must be sufficient for another engineer to implement the entire system without clarification.",
    "type": "object",
    "required": [
      "system_overview",
      "service_architecture",
      "data_flows",
      "trust_boundaries",
      "async_and_background_processing",
      "design_tradeoffs",
      "risk_analysis",
      "expected_vulnerabilities"
    ],
    "additionalProperties": false,
  
    "properties": {
      "system_overview": {
        "type": "object",
        "required": [
          "product_goal",
          "assumed_users",
          "traffic_patterns",
          "non_goals",
          "explicitly_unprotected_areas"
        ],
        "additionalProperties": false,
        "properties": {
          "product_goal": { "type": "string", "minLength": 20 },
          "assumed_users": { "type": "string", "minLength": 20 },
          "traffic_patterns": { "type": "string", "minLength": 20 },
          "non_goals": { "type": "string", "minLength": 20 },
          "explicitly_unprotected_areas": { "type": "string", "minLength": 20 }
        }
      },
  
      "service_architecture": {
        "type": "array",
        "minItems": 6,
        "items": {
          "type": "object",
          "required": [
            "service_name",
            "language",
            "responsibilities",
            "data_owned",
            "external_dependencies",
            "trust_level",
            "split_rationale"
          ],
          "additionalProperties": false,
          "properties": {
            "service_name": { "type": "string" },
            "language": { "type": "string" },
            "responsibilities": { "type": "string", "minLength": 30 },
            "data_owned": { "type": "string", "minLength": 20 },
            "external_dependencies": { "type": "string", "minLength": 10 },
            "trust_level": {
              "type": "string",
              "enum": ["internal", "semi-trusted", "untrusted"]
            },
            "split_rationale": { "type": "string", "minLength": 20 }
          }
        }
      },
  
      "data_flows": {
        "type": "array",
        "minItems": 1,
        "items": {
          "type": "object",
          "required": [
            "source",
            "destination",
            "protocol",
            "authentication_assumptions",
            "authorization_assumptions",
            "implicit_trust"
          ],
          "additionalProperties": false,
          "properties": {
            "source": { "type": "string" },
            "destination": { "type": "string" },
            "protocol": { "type": "string" },
            "authentication_assumptions": { "type": "string", "minLength": 15 },
            "authorization_assumptions": { "type": "string", "minLength": 15 },
            "implicit_trust": { "type": "string", "minLength": 15 }
          }
        }
      },
  
      "trust_boundaries": {
        "type": "array",
        "minItems": 1,
        "items": {
          "type": "object",
          "required": [
            "boundary_id",
            "components",
            "why_boundary_exists",
            "assumptions",
            "failure_modes"
          ],
          "additionalProperties": false,
          "properties": {
            "boundary_id": { "type": "string" },
            "components": {
              "type": "array",
              "minItems": 2,
              "items": { "type": "string" }
            },
            "why_boundary_exists": { "type": "string", "minLength": 20 },
            "assumptions": { "type": "string", "minLength": 20 },
            "failure_modes": { "type": "string", "minLength": 20 }
          }
        }
      },
  
      "async_and_background_processing": {
        "type": "array",
        "items": {
          "type": "object",
          "required": [
            "worker_name",
            "trigger",
            "state_model",
            "retry_behavior",
            "failure_assumptions"
          ],
          "additionalProperties": false,
          "properties": {
            "worker_name": { "type": "string" },
            "trigger": { "type": "string", "minLength": 10 },
            "state_model": { "type": "string", "minLength": 15 },
            "retry_behavior": { "type": "string", "minLength": 15 },
            "failure_assumptions": { "type": "string", "minLength": 15 }
          }
        }
      },
  
      "design_tradeoffs": {
        "type": "array",
        "minItems": 1,
        "items": {
          "type": "object",
          "required": [
            "decision",
            "justification",
            "introduced_risks",
            "why_accepted"
          ],
          "additionalProperties": false,
          "properties": {
            "decision": { "type": "string", "minLength": 15 },
            "justification": { "type": "string", "minLength": 20 },
            "introduced_risks": { "type": "string", "minLength": 20 },
            "why_accepted": { "type": "string", "minLength": 15 }
          }
        }
      },
  
      "risk_analysis": {
        "type": "array",
        "minItems": 1,
        "items": {
          "type": "object",
          "required": [
            "risk_id",
            "originating_architectural_decision",
            "affected_services",
            "vulnerability_class",
            "manifestation",
            "why_it_survives_reviews"
          ],
          "additionalProperties": false,
          "properties": {
            "risk_id": { "type": "string" },
            "originating_architectural_decision": {
              "type": "string",
              "minLength": 20
            },
            "affected_services": {
              "type": "array",
              "minItems": 1,
              "items": { "type": "string" }
            },
            "vulnerability_class": { "type": "string" },
            "manifestation": { "type": "string", "minLength": 30 },
            "why_it_survives_reviews": {
              "type": "string",
              "minLength": 30
            }
          }
        }
      },
  
      "expected_vulnerabilities": {
        "type": "object",
        "required": [
          "total_count",
          "distribution_by_class",
          "rationale"
        ],
        "additionalProperties": false,
        "properties": {
          "total_count": {
            "type": "integer",
            "minimum": 1
          },
          "distribution_by_class": {
            "type": "object",
            "minProperties": 1,
            "additionalProperties": {
              "type": "integer",
              "minimum": 1
            }
          },
          "rationale": {
            "type": "string",
            "minLength": 30
          }
        }
      }
    }
  }
  